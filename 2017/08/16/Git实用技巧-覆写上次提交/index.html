<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="ziheng&#39;s Blog">
    <meta name="keyword" content="blog">
    <meta name="google-site-verification" content="k8kEwQr5uL4wgMXhsZcUzGeY-tvr8yd23gMfzGcxqrE" />
    <link rel="shortcut icon" href="/img/favicon.png">
    <link rel="canonical" href="https://zihengcat.github.io/2017/08/16/Git实用技巧-覆写上次提交/">
    <title>
        
          Git 实用技巧 - 覆写上次提交（amend） - zihengCat
        
    </title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.css">

    <!-- Font-Awesome Fonts -->
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hook -->
    <script></script>
</head>

<body>
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
                ziheng&#39;s Blog
            </a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                        
                    
                        
                        <li>
                            <a href="/about/">
                                About
                            </a>
                        </li>
                        
                    
                        
                        <li>
                            <a href="/archives/">
                                Archives
                            </a>
                        </li>
                        
                    
                        
                        <li>
                            <a href="/tags/">
                                Tags
                            </a>
                        </li>
                        
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');
    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px";
                }
            },400)
        } else {
        // OPEN
            $collapse.style.height = "auto";
            $navbar.className += " in";
        }
    }
</script>

    <!-- Post Header -->
<style type="text/css">
    header.intro-header {
        background-image: url('/img/home-bg-o.jpg');
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#Git" title="Git">Git</a>
                        
                    </div>
                    <h1>Git 实用技巧 - 覆写上次提交（amend）</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by zihengCat on
                        2017-08-16
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>
<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
<!-- Post Container -->
            <div class="
                 col-lg-8 col-lg-offset-2
                 col-md-10 col-md-offset-1
                 post-container">
                <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>我们在日常使用<code>Git</code>时，有时会遇到需要修改上次<code>commit</code>提交信息的情况。比如：修改上次提交信息中的错误内容，或者想为上次提交加入些新内容等等。</p>
<h1 id="Git覆写上次提交（amend）"><a href="#Git覆写上次提交（amend）" class="headerlink" title="Git覆写上次提交（amend）"></a><code>Git</code>覆写上次提交（amend）</h1><p>我们可以使用<code>git commit</code>命令的<code>amend</code>选项来覆写上次提交。</p>
<pre><code>$ git commit --amend
</code></pre><blockquote>
<p>代码清单：使用<code>--amend</code>选项覆写上次提交</p>
</blockquote>
<p>执行此命令后，<code>git</code>会自动弹出编辑界面，让你可以修改上次的<strong>提交信息</strong>。</p>
<pre><code>$ git commit --amend -m &quot;an updated commit message&quot;
</code></pre><blockquote>
<p>代码清单：使用<code>-m</code>选项快速修改</p>
</blockquote>
<p>而使用<code>--no-edit</code>选项，表示不更动上次已经提交的信息。适用于添加新内容到上次提交的情况。</p>
<pre><code>$ git commit --amend --no-edit
</code></pre><blockquote>
<p>代码清单：使用<code>--no-edit</code>选项</p>
</blockquote>
<h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><pre><code>--amend

    Replace the tip of the current branch by creating a new
    commit. The recorded tree is prepared as usual (including
    the effect of the -i and -o options and explicit pathspec),
    and the message from the original commit is used as the
    starting point, instead of an empty message, when no other
    message is specified from the command line via options such
    as -m, -F, -c, etc. The new commit has the same parents and
    author as the current one (the --reset-author option can
    countermand this).

    It is a rough equivalent for:

                $ git reset --soft HEAD^
                $ ... do something else to come up with the right tree ...
                $ git commit -c ORIG_HEAD

    but can be used to amend a merge commit.

    You should understand the implications of rewriting history
    if you amend a commit that has already been published. (See
    the &quot;RECOVERING FROM UPSTREAM REBASE&quot; section in git-
    rebase(1).)

</code></pre><blockquote>
<p>注：关于<code>--amend</code>的说明（取自<code>git help</code>）</p>
</blockquote>
<p>需要注意的是，<code>amend</code>选项不会<strong>直接修改</strong>上次的提交，而是会<strong>新创建</strong>出一枚提交，包含了上次提交的全部内容与新添加的内容，原提交会被”删除”。可以观察到，修改前后的提交<code>hash</code>值是不同的。</p>
<p>所以，<strong>对于已经推送到远程仓库的提交</strong>，要谨慎使用<code>amend</code>选项。</p>
<pre><code>$ git push &lt;remote&gt; &lt;branch&gt; --force
</code></pre><blockquote>
<p>代码清单：强制覆盖远程分支</p>
</blockquote>
<p>而对于已经推送到远程仓库的提交，可以使用<strong>强制推送</strong>来覆盖（谨慎使用）。</p>
<p><img src="./amend-pic.svg" alt="amend-pic"></p>
<blockquote>
<p>图：<code>git commit --amend</code> 原理示意图（取自Atlassian）</p>
</blockquote>
<p><img src="./amend-caution.jpg" alt="amend-caution"></p>
<blockquote>
<p>图：<code>git commit --amend</code> 注意事项图（取自Pikicast）</p>
</blockquote>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><p>Atlassian Tutorials：<a href="https://www.atlassian.com/git/tutorials/rewriting-history" target="_blank" rel="noopener">https://www.atlassian.com/git/tutorials/rewriting-history</a></p>
</li>
<li><p>重写项目历史：<a href="https://github.com/geeeeeeeeek/git-recipes/wiki/2.7-%E9%87%8D%E5%86%99%E9%A1%B9%E7%9B%AE%E5%8E%86%E5%8F%B2" target="_blank" rel="noopener">https://github.com/geeeeeeeeek/git-recipes/wiki/2.7-%E9%87%8D%E5%86%99%E9%A1%B9%E7%9B%AE%E5%8E%86%E5%8F%B2</a></p>
</li>
</ul>

                <hr>
<!--
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2017/08/18/Linux系统SSH密钥方式登陆/" data-toggle="tooltip" data-placement="top" title="Linux系统配置SSH密钥登陆（免密码）">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2017/08/13/移除苹果系统下载文件的附加属性/" data-toggle="tooltip" data-placement="top" title="移除苹果系统下载文件的附加属性">Next Post &rarr;</a>
                        </li>
                    
                </ul>
-->
            </div>
<!-- Side Catalog Container -->
        
<!-- Sidebar Container -->
            <div class="
                 col-lg-8 col-lg-offset-2
                 col-md-10 col-md-offset-1
                 sidebar-container">
                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Git" title="Git">Git</a>
                        
                    </div>
                </section>
                
                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>


    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
<!--
            
              <li>
                <a target="_blank"  href="https://github.com/zihengcat">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
            

            
-->
        </ul>
        <p class="copyright text-muted">
            Copyright &copy;
            ziheng&#39;s Blog
            2018
          <br>
            Theme by Hux
<!--
            <span style="display: inline-block; margin: 0 5px;">
            <i class="fa fa-heart"></i>
            </span>
-->
            <span> | </span>
            Ported by Kaijun
            <span> | </span>
            Modified by zihengCat
<!--
          <iframe
           style="margin-left: 2px; margin-bottom:-5px;"
           frameborder="0" scrolling="0" width="91px" height="20px"
           src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true" >
          </iframe>
-->
          </br>
          <span id="busuanzi_container_site_pv">
            本站访问量<span id="busuanzi_value_site_pv"></span>次 |
          </span>
          <span id="busuanzi_container_site_uv">
            本站访客数<span id="busuanzi_value_site_uv"></span>人 |
          </span>
          <span id="busuanzi_container_page_pv">
            本文阅读量<span id="busuanzi_value_page_pv"></span>次
          </span>
        </p>
      </div>
    </div>
  </div>
</footer>


<!-- BuSuanzi.js -->
<script type="text/javascript" async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<!-- Highlight.js -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>



<script type="text/javascript" async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$', '$'] ],
            skipTags: ['code', 'script', 'noscript', 'style', 'textarea', 'pre']
        }
    });
</script>


<!-- jQuery -->
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

<!-- Custom JavaScript -->
<script src="/js/hux-blog.js"></script>

<!-- Async Load Function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) {
          o.addEventListener(
              'load',
              function (e) {
                  c(null, e);
              },
              false
          );
      }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jQuery.tagCloud.js -->
<script type="text/javascript">
    /* only load `jQuery.tagCloud.js` in `tag.html` */
    if($('#tag_cloud').length !== 0) {
        /* use `rawgithubusercontent` for `MIME type` */
        async("https://rawgithubusercontent.com/addywaddy/jquery.tagcloud.js/master/jquery.tagcloud.js",
        function() {
            $.fn.tagcloud.defaults = {
                // size: { start: 1, end: 1, unit: 'em' },
                color: { start: '#bbbbee', end: '#0085a1' },
            };
            $('#tag_cloud a').tagcloud();
        });
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js",
    function(){
        var $nav = document.querySelector("nav");
        if($nav) {
            FastClick.attach($nav);
        }
    })
</script>

<!-- Side Catalog -->


</body>
</html>
